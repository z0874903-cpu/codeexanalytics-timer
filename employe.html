<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeExAnalytics | Employee Portal</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --primary-light: #dbeafe;
            --secondary: #059669;
            --accent: #7c3aed;
            --dark: #1f2937;
            --light: #f9fafb;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
        }
        
        .stat-card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            border: 1px solid rgba(229, 231, 235, 0.5);
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(37, 99, 235, 0.3);
        }
        
        .sidebar {
            background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%);
            color: white;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 40;
            overflow-y: auto;
            transition: transform 0.3s ease;
        }
        
        .sidebar-item {
            transition: all 0.2s ease;
            border-radius: 10px;
        }
        
        .sidebar-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }
        
        .sidebar-item.active {
            background: rgba(37, 99, 235, 0.2);
            border-left: 4px solid var(--primary);
        }
        
        .timer-display {
            font-family: 'JetBrains Mono', monospace;
            text-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }
        
        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: white;
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
        }
        
        .badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .badge-primary {
            background: var(--primary-light);
            color: var(--primary-dark);
        }
        
        .badge-success {
            background: #d1fae5;
            color: var(--secondary);
        }
        
        .badge-warning {
            background: #fef3c7;
            color: #d97706;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: white;
            margin: 5% auto;
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
            animation: modalSlide 0.3s ease;
        }
        
        @keyframes modalSlide {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--dark);
            color: white;
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            animation: toastSlide 0.3s ease;
            z-index: 1001;
        }
        
        @keyframes toastSlide {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .table-row {
            transition: all 0.2s ease;
        }
        
        .table-row:hover {
            background: #f8fafc;
            transform: scale(1.002);
        }
        
        .input-field {
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            transition: all 0.2s ease;
        }
        
        .input-field:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        .select-field {
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            transition: all 0.2s ease;
        }
        
        .select-field:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        /* Desktop */
        @media (min-width: 1024px) {
            .sidebar {
                width: 280px;
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 280px;
                padding-top: 64px;
            }
            
            .mobile-menu-toggle {
                display: none;
            }
        }
        
        /* Tablet */
        @media (max-width: 1023px) and (min-width: 768px) {
            .sidebar {
                width: 280px;
                transform: translateX(-100%);
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
                padding-top: 64px;
            }
            
            .mobile-menu-toggle {
                display: flex;
                position: fixed;
                top: 1rem;
                left: 1rem;
                z-index: 50;
                width: 48px;
                height: 48px;
                border-radius: 12px;
                background: var(--primary);
                color: white;
                align-items: center;
                justify-content: center;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            }
        }
        
        /* Mobile */
        @media (max-width: 767px) {
            .sidebar {
                width: 100%;
                transform: translateX(-100%);
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
                padding-top: 64px;
                padding-left: 1rem;
                padding-right: 1rem;
            }
            
            .mobile-menu-toggle {
                display: flex;
                position: fixed;
                top: 1rem;
                left: 1rem;
                z-index: 50;
                width: 48px;
                height: 48px;
                border-radius: 12px;
                background: var(--primary);
                color: white;
                align-items: center;
                justify-content: center;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            }
            
            .timer-display {
                font-size: 3rem;
            }
            
            .stat-card {
                padding: 1rem;
            }
        }
    </style>
</head>
<body class="text-gray-800">
    <!-- Login Page -->
    <div id="loginPage" class="min-h-screen flex items-center justify-center p-4">
        <div class="w-full max-w-md">
            <div class="glass-card rounded-2xl p-8">
                <div class="text-center mb-8">
                    <div class="w-16 h-16 gradient-bg rounded-2xl flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-chart-line text-white text-2xl"></i>
                    </div>
                    <h1 class="text-3xl font-bold text-gray-900">CodeExAnalytics</h1>
                    <p class="text-gray-600 mt-2">Employee Time Portal</p>
                </div>
                
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-gray-900 mb-2">Welcome Back</h2>
                    <p class="text-gray-600">Sign in to track your work hours</p>
                </div>
                
                <div class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Email Address</label>
                        <input type="email" id="loginEmail" class="w-full px-4 py-3 input-field" 
                               placeholder="you@codeexanalytics.com" value="john.doe@codeexanalytics.com">
                    </div>
                    
                    <div>
                        <div class="flex justify-between items-center mb-2">
                            <label class="block text-sm font-medium text-gray-700">Password</label>
                            <button onclick="showResetPassword()" class="text-sm text-blue-600 hover:text-blue-800">
                                Forgot password?
                            </button>
                        </div>
                        <input type="password" id="loginPassword" class="w-full px-4 py-3 input-field" 
                               placeholder="••••••••" value="password123">
                    </div>
                    
                    <div class="flex items-center">
                        <input type="checkbox" id="rememberMe" class="h-4 w-4 text-blue-600 rounded">
                        <label for="rememberMe" class="ml-2 text-sm text-gray-700">Remember me</label>
                    </div>
                    
                    <button onclick="login()" class="w-full btn-primary py-3 rounded-xl font-medium text-lg">
                        Sign In
                    </button>
                    
                    <div class="text-center pt-6 border-t border-gray-100">
                        <p class="text-gray-600">Don't have an account? 
                            <button onclick="showSignup()" class="text-blue-600 hover:text-blue-800 font-medium">
                                Contact Admin
                            </button>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="dashboardPage" class="hidden">
        <!-- Navigation -->
        <nav class="bg-white border-b border-gray-200 fixed w-full z-50 shadow-sm">
            <div class="px-6 h-16 flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button class="mobile-menu-toggle lg:hidden" onclick="toggleMobileMenu()">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 gradient-bg rounded-xl flex items-center justify-center">
                            <i class="fas fa-clock text-white"></i>
                        </div>
                        <div>
                            <h1 class="text-lg font-bold text-gray-900">Employee Time Tracker</h1>
                        </div>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="text-right hidden md:block">
                        <p class="text-sm font-medium" id="currentDateTime"></p>
                        <p class="text-xs text-gray-500">Auto-save enabled</p>
                    </div>
                    <div class="relative">
                        <button id="userMenuBtn" class="flex items-center space-x-2 px-4 py-2 rounded-xl hover:bg-gray-50 transition-colors">
                            <div class="avatar" id="userAvatar">JD</div>
                            <div class="text-left">
                                <p class="text-sm font-medium" id="userName">John Doe</p>
                                <p class="text-xs text-gray-500">Employee</p>
                            </div>
                            <i class="fas fa-chevron-down text-gray-400 text-xs ml-2"></i>
                        </button>
                        <div id="userDropdown" class="absolute right-0 mt-2 w-56 bg-white rounded-xl shadow-lg border border-gray-200 hidden z-20">
                            <div class="p-4 border-b border-gray-100">
                                <p class="text-sm font-medium" id="dropdownName">John Doe</p>
                                <p class="text-xs text-gray-500" id="dropdownEmail">john@codeexanalytics.com</p>
                            </div>
                            <div class="p-2">
                                <button onclick="switchTab('profile')" class="w-full text-left px-3 py-3 text-sm text-gray-700 hover:bg-gray-100 rounded-lg transition-colors">
                                    <i class="fas fa-user mr-2 text-gray-400"></i>My Profile
                                </button>
                                <button onclick="exportMyData()" class="w-full text-left px-3 py-3 text-sm text-gray-700 hover:bg-gray-100 rounded-lg transition-colors">
                                    <i class="fas fa-download mr-2 text-gray-400"></i>Export My Data
                                </button>
                                <button onclick="logout()" class="w-full text-left px-3 py-3 text-sm text-red-600 hover:bg-red-50 rounded-lg transition-colors mt-2">
                                    <i class="fas fa-sign-out-alt mr-2"></i>Sign Out
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Sidebar -->
        <div class="sidebar">
            <div class="p-4 pt-20 lg:pt-4">
                <h2 class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-4">My Workspace</h2>
                <nav class="space-y-1">
                    <button onclick="switchTab('dashboard')" class="w-full flex items-center space-x-3 px-4 py-3 sidebar-item text-left" data-tab="dashboard">
                        <i class="fas fa-chart-pie w-5"></i>
                        <span>Dashboard</span>
                    </button>
                    <button onclick="switchTab('timer')" class="w-full flex items-center space-x-3 px-4 py-3 sidebar-item text-left" data-tab="timer">
                        <i class="fas fa-clock w-5"></i>
                        <span>Time Tracker</span>
                    </button>
                    <button onclick="switchTab('history')" class="w-full flex items-center space-x-3 px-4 py-3 sidebar-item text-left" data-tab="history">
                        <i class="fas fa-history w-5"></i>
                        <span>Work History</span>
                    </button>
                </nav>
            </div>
            
            <div class="p-4 mt-6">
                <h2 class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-4">Quick Actions</h2>
                <div class="space-y-2">
                    <button onclick="startQuickTimer()" class="w-full btn-primary py-2 rounded-lg text-sm font-medium">
                        <i class="fas fa-play mr-2"></i>Start Timer
                    </button>
                    <button onclick="showAddEntryModal()" class="w-full bg-white text-gray-700 border border-gray-300 py-2 rounded-lg text-sm font-medium hover:bg-gray-50">
                        <i class="fas fa-plus mr-2"></i>Add Entry
                    </button>
                </div>
            </div>
            
            <div class="p-4 mt-6 border-t border-gray-700">
                <div class="text-xs text-gray-400">
                    <p><i class="fas fa-sync-alt mr-2"></i>Last sync: <span id="lastSync">Just now</span></p>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content p-6 bg-gray-50 min-h-screen">
            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content">
                <div class="mb-8">
                    <h1 class="text-3xl font-bold text-gray-900">My Dashboard</h1>
                    <p class="text-gray-600">Overview of your productivity and work hours</p>
                </div>
                
                <!-- Stats Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="stat-card p-6">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <p class="text-sm text-gray-500 font-medium">Today's Hours</p>
                                <p class="text-3xl font-bold text-gray-900 mt-2" id="todayHours">0.0</p>
                            </div>
                            <div class="w-12 h-12 bg-blue-50 rounded-xl flex items-center justify-center">
                                <i class="fas fa-clock text-blue-500 text-xl"></i>
                            </div>
                        </div>
                        <div class="flex items-center text-sm text-gray-500">
                            <i class="fas fa-list mr-2"></i>
                            <span id="todaySessions">0</span> sessions today
                        </div>
                    </div>
                    
                    <div class="stat-card p-6">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <p class="text-sm text-gray-500 font-medium">Weekly Total</p>
                                <p class="text-3xl font-bold text-gray-900 mt-2" id="weeklyTotal">0.0</p>
                            </div>
                            <div class="w-12 h-12 bg-green-50 rounded-xl flex items-center justify-center">
                                <i class="fas fa-calendar-alt text-green-500 text-xl"></i>
                            </div>
                        </div>
                        <div class="flex items-center text-sm text-gray-500">
                            <i class="fas fa-calendar-day mr-2"></i>
                            <span id="daysThisWeek">0</span> work days
                        </div>
                    </div>
                    
                    <div class="stat-card p-6">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <p class="text-sm text-gray-500 font-medium">Current Status</p>
                                <p class="text-2xl font-bold text-gray-900 mt-2" id="currentStatus">Not Working</p>
                            </div>
                            <div class="w-12 h-12 bg-purple-50 rounded-xl flex items-center justify-center">
                                <i class="fas fa-user-check text-purple-500 text-xl"></i>
                            </div>
                        </div>
                        <p class="text-sm text-gray-500" id="statusDetail">Ready to start tracking</p>
                    </div>
                    
                    <div class="stat-card p-6">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <p class="text-sm text-gray-500 font-medium">Productivity</p>
                                <p class="text-3xl font-bold text-gray-900 mt-2" id="productivityScore">0%</p>
                            </div>
                            <div class="w-12 h-12 bg-orange-50 rounded-xl flex items-center justify-center">
                                <i class="fas fa-chart-line text-orange-500 text-xl"></i>
                            </div>
                        </div>
                        <p class="text-sm text-gray-500">Weekly efficiency</p>
                    </div>
                </div>
                
                <!-- Charts -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <div class="stat-card p-6">
                        <h3 class="text-lg font-semibold mb-4">Weekly Hours Breakdown</h3>
                        <div class="h-64">
                            <canvas id="weeklyChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="stat-card p-6">
                        <h3 class="text-lg font-semibold mb-4">Project Distribution</h3>
                        <div class="h-64">
                            <canvas id="projectChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- Today's Activity -->
                <div class="stat-card">
                    <div class="p-6 border-b border-gray-100">
                        <div class="flex justify-between items-center">
                            <h3 class="text-lg font-semibold">Today's Work Sessions</h3>
                            <button onclick="switchTab('history')" class="text-sm text-blue-600 hover:text-blue-800 font-medium flex items-center">
                                View all history <i class="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                    <div class="p-6">
                        <div id="dashboardActivity" class="space-y-4">
                            <!-- Activity will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Timer Tab -->
            <div id="timer" class="tab-content hidden">
                <div class="max-w-4xl mx-auto">
                    <div class="mb-8 text-center">
                        <h1 class="text-3xl font-bold text-gray-900">Time Tracking</h1>
                        <p class="text-gray-600">Track your work hours with precision</p>
                    </div>
                    
                    <div class="stat-card overflow-hidden">
                        <div class="p-8">
                            <!-- Timer Display -->
                            <div class="text-center mb-10">
                                <div class="timer-display text-8xl font-bold text-gray-900 mb-4" id="timerDisplay">00:00:00</div>
                                <div class="text-gray-500 text-lg mb-8">
                                    <span id="currentTimerInfo">Ready to start working</span>
                                </div>
                                
                                <div class="flex justify-center space-x-4 mb-10">
                                    <button id="startBtn" onclick="startTimer()" class="btn-primary px-10 py-4 rounded-xl font-medium text-lg flex items-center space-x-3">
                                        <i class="fas fa-play"></i>
                                        <span>Start Timer</span>
                                    </button>
                                    <button id="stopBtn" onclick="stopTimer()" class="bg-gray-800 text-white px-10 py-4 rounded-xl font-medium text-lg flex items-center space-x-3 hidden">
                                        <i class="fas fa-stop"></i>
                                        <span>Stop Timer</span>
                                    </button>
                                    <button id="pauseBtn" onclick="pauseTimer()" class="border-2 border-gray-300 text-gray-700 px-8 py-4 rounded-xl font-medium text-lg hidden">
                                        <i class="fas fa-pause"></i>
                                        <span>Pause</span>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Timer Form -->
                            <div class="mb-8">
                                <label class="block text-sm font-medium text-gray-700 mb-2">What are you working on?</label>
                                <div class="flex space-x-4">
                                    <input type="text" id="taskInput" class="flex-1 px-4 py-3 input-field" placeholder="Describe your task...">
                                    <select id="projectSelect" class="px-4 py-3 select-field">
                                        <option value="General">General</option>
                                        <option value="Client Project">Client Project</option>
                                        <option value="Internal Development">Internal Development</option>
                                        <option value="Meeting">Meeting</option>
                                        <option value="Training">Training</option>
                                        <option value="Administrative">Administrative</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Summary Cards -->
                    <div class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="stat-card p-6">
                            <h3 class="text-lg font-semibold mb-4">Current Session</h3>
                            <div id="currentSessionInfo" class="space-y-3">
                                <div class="text-center py-6 text-gray-400">
                                    <i class="fas fa-clock text-4xl mb-3"></i>
                                    <p>No active session</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="stat-card p-6">
                            <h3 class="text-lg font-semibold mb-4">Today's Summary</h3>
                            <div id="todaySummary" class="space-y-4">
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600">Total Hours:</span>
                                    <span class="text-xl font-bold text-gray-900" id="todayHoursSummary">0.0</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600">Sessions:</span>
                                    <span class="text-xl font-bold text-gray-900" id="todaySessionsSummary">0</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600">Avg. Session:</span>
                                    <span class="text-xl font-bold text-gray-900" id="avgSessionTime">0m</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="stat-card p-6">
                            <h3 class="text-lg font-semibold mb-4">Quick Actions</h3>
                            <div class="space-y-3">
                                <button onclick="addQuickEntry('Meeting')" class="w-full text-left px-4 py-3 bg-blue-50 hover:bg-blue-100 text-blue-700 rounded-lg transition-colors">
                                    <i class="fas fa-users mr-2"></i> Add Meeting
                                </button>
                                <button onclick="showAddEntryModal()" class="w-full text-left px-4 py-3 bg-gray-50 hover:bg-gray-100 text-gray-700 rounded-lg transition-colors">
                                    <i class="fas fa-plus mr-2"></i> Manual Entry
                                </button>
                                <button onclick="switchTab('history')" class="w-full text-left px-4 py-3 bg-green-50 hover:bg-green-100 text-green-700 rounded-lg transition-colors">
                                    <i class="fas fa-history mr-2"></i> View History
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- History Tab -->
            <div id="history" class="tab-content hidden">
                <div class="mb-8">
                    <h1 class="text-3xl font-bold text-gray-900">Work History</h1>
                    <p class="text-gray-600">Complete history of all your tracked time</p>
                </div>
                
                <!-- Filters -->
                <div class="stat-card p-6 mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Date Range</label>
                            <select id="dateRangeFilter" class="w-full px-3 py-2 select-field">
                                <option value="today">Today</option>
                                <option value="week">This Week</option>
                                <option value="month">This Month</option>
                                <option value="all">All Time</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Project</label>
                            <select id="projectFilter" class="w-full px-3 py-2 select-field">
                                <option value="all">All Projects</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Sort By</label>
                            <select id="sortFilter" class="w-full px-3 py-2 select-field">
                                <option value="newest">Newest First</option>
                                <option value="oldest">Oldest First</option>
                                <option value="duration">Longest First</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Actions</label>
                            <div class="flex space-x-2">
                                <button onclick="filterHistory()" class="flex-1 btn-primary py-2 rounded-lg text-sm">Filter</button>
                                <button onclick="resetHistoryFilters()" class="flex-1 border border-gray-300 py-2 rounded-lg text-sm hover:bg-gray-50">Reset</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Records Table -->
                <div class="stat-card overflow-hidden">
                    <div class="p-6 border-b border-gray-100 flex justify-between items-center">
                        <h3 class="text-lg font-semibold">Time Records</h3>
                        <div class="flex items-center space-x-3">
                            <span class="text-sm text-gray-500" id="recordsCount">0 records</span>
                            <button onclick="exportMyData()" class="text-sm text-blue-600 hover:text-blue-800 font-medium">
                                <i class="fas fa-download mr-1"></i>Export
                            </button>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="text-left py-4 px-6 text-sm font-medium text-gray-700">Date</th>
                                    <th class="text-left py-4 px-6 text-sm font-medium text-gray-700">Project</th>
                                    <th class="text-left py-4 px-6 text-sm font-medium text-gray-700">Task</th>
                                    <th class="text-left py-4 px-6 text-sm font-medium text-gray-700">Start Time</th>
                                    <th class="text-left py-4 px-6 text-sm font-medium text-gray-700">End Time</th>
                                    <th class="text-left py-4 px-6 text-sm font-medium text-gray-700">Duration</th>
                                    <th class="text-left py-4 px-6 text-sm font-medium text-gray-700">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="historyTable" class="divide-y divide-gray-100"></tbody>
                        </table>
                    </div>
                    <div class="p-8 text-center" id="historyEmpty">
                        <div class="py-8">
                            <i class="fas fa-history text-4xl mb-3 text-gray-300"></i>
                            <p class="text-gray-500 font-medium">No work history yet</p>
                            <p class="text-sm text-gray-400 mt-1">Start tracking your time to see history here</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Profile Tab -->
            <div id="profile" class="tab-content hidden">
                <div class="max-w-4xl mx-auto">
                    <div class="mb-8">
                        <h1 class="text-3xl font-bold text-gray-900">My Profile</h1>
                        <p class="text-gray-600">Manage your account information</p>
                    </div>
                    
                    <div class="stat-card overflow-hidden">
                        <div class="p-8">
                            <!-- Profile Header -->
                            <div class="flex items-center space-x-6 mb-8">
                                <div class="w-24 h-24 gradient-bg rounded-full flex items-center justify-center text-white text-3xl font-bold" id="profileAvatar">
                                    JD
                                </div>
                                <div>
                                    <h2 class="text-2xl font-bold text-gray-900" id="profileName">John Doe</h2>
                                    <p class="text-gray-600" id="profileEmailDisplay">john@codeexanalytics.com</p>
                                    <p class="text-sm text-gray-500 mt-1">Employee • Member since <span id="memberSince">2024</span></p>
                                </div>
                            </div>
                            
                            <!-- Profile Info -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">First Name</label>
                                    <input type="text" id="profileFirstName" class="w-full px-4 py-3 input-field" readonly>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Last Name</label>
                                    <input type="text" id="profileLastName" class="w-full px-4 py-3 input-field" readonly>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Email Address</label>
                                    <input type="email" id="profileEmail" class="w-full px-4 py-3 input-field" readonly>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Employee ID</label>
                                    <input type="text" id="profileEmployeeId" class="w-full px-4 py-3 input-field" readonly>
                                </div>
                            </div>
                            
                            <!-- Statistics -->
                            <div class="border-t border-gray-200 pt-8">
                                <h3 class="text-lg font-semibold mb-6">Your Statistics</h3>
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                    <div class="bg-blue-50 p-4 rounded-xl">
                                        <p class="text-sm text-blue-600 font-medium">Total Hours</p>
                                        <p class="text-2xl font-bold text-gray-900" id="profileTotalHours">0</p>
                                    </div>
                                    <div class="bg-green-50 p-4 rounded-xl">
                                        <p class="text-sm text-green-600 font-medium">Sessions</p>
                                        <p class="text-2xl font-bold text-gray-900" id="profileSessions">0</p>
                                    </div>
                                    <div class="bg-purple-50 p-4 rounded-xl">
                                        <p class="text-sm text-purple-600 font-medium">Avg. Daily</p>
                                        <p class="text-2xl font-bold text-gray-900" id="profileAvgDaily">0.0</p>
                                    </div>
                                    <div class="bg-orange-50 p-4 rounded-xl">
                                        <p class="text-sm text-orange-600 font-medium">Productivity</p>
                                        <p class="text-2xl font-bold text-gray-900" id="profileProductivity">0%</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Actions -->
                            <div class="border-t border-gray-200 pt-8">
                                <h3 class="text-lg font-semibold mb-4">Account Actions</h3>
                                <div class="flex space-x-4">
                                    <button onclick="exportMyData()" class="btn-primary px-6 py-3 rounded-lg font-medium">
                                        <i class="fas fa-download mr-2"></i>Export All My Data
                                    </button>
                                    <button onclick="logout()" class="border-2 border-red-200 text-red-600 px-6 py-3 rounded-lg font-medium hover:bg-red-50">
                                        <i class="fas fa-sign-out-alt mr-2"></i>Sign Out
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add Entry Modal -->
        <div id="addEntryModal" class="modal">
            <div class="modal-content w-11/12 md:w-1/2 lg:w-1/3">
                <div class="p-6 border-b border-gray-100">
                    <h3 class="text-lg font-semibold">Add Manual Time Entry</h3>
                </div>
                <div class="p-6">
                    <div class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Project</label>
                            <select id="manualProject" class="w-full px-3 py-3 select-field">
                                <option value="General">General</option>
                                <option value="Client Project">Client Project</option>
                                <option value="Meeting">Meeting</option>
                                <option value="Training">Training</option>
                                <option value="Administrative">Administrative</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Task Description</label>
                            <input type="text" id="manualTask" class="w-full px-3 py-3 input-field" placeholder="What did you work on?">
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Start Time</label>
                                <input type="datetime-local" id="manualStartTime" class="w-full px-3 py-3 input-field">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">End Time</label>
                                <input type="datetime-local" id="manualEndTime" class="w-full px-3 py-3 input-field">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="p-6 border-t border-gray-100 flex justify-end space-x-3">
                    <button onclick="closeModal('addEntryModal')" class="px-5 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">Cancel</button>
                    <button onclick="saveManualEntry()" class="btn-primary px-5 py-2 rounded-lg">Save Entry</button>
                </div>
            </div>
        </div>

        <!-- Notification Toast -->
        <div id="toast" class="toast hidden"></div>
    </div>

    <script>
        // ==================== GLOBAL VARIABLES ====================
        let currentUser = null;
        let timeRecords = JSON.parse(localStorage.getItem('ce_time_records')) || [];
        let currentTimer = null;
        let timerInterval = null;
        let totalSeconds = 0;
        let weeklyChart = null;
        let projectChart = null;

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', function() {
            initializeDefaultData();
            
            const savedUserId = sessionStorage.getItem('ce_current_employee');
            if (savedUserId) {
                const userId = JSON.parse(savedUserId);
                const allUsers = JSON.parse(localStorage.getItem('ce_users')) || [];
                currentUser = allUsers.find(u => u.id === userId);
                
                if (currentUser) {
                    document.getElementById('loginPage').style.display = 'none';
                    document.getElementById('dashboardPage').style.display = 'block';
                    initializeDashboard();
                }
            }
            
            setupEventListeners();
        });

        function initializeDefaultData() {
            let allUsers = JSON.parse(localStorage.getItem('ce_users')) || [];
            if (allUsers.length === 0) {
                const defaultEmployee = {
                    id: 'emp_001',
                    firstName: 'John',
                    lastName: 'Doe',
                    email: 'john.doe@codeexanalytics.com',
                    password: 'password123',
                    role: 'employee',
                    department: 'Development',
                    position: 'Software Developer',
                    employeeId: 'EMP001',
                    createdAt: new Date().toISOString()
                };
                allUsers.push(defaultEmployee);
                localStorage.setItem('ce_users', JSON.stringify(allUsers));
            }
            
            if (timeRecords.length === 0) {
                localStorage.setItem('ce_time_records', JSON.stringify([]));
                timeRecords = [];
            }
        }

        function setupEventListeners() {
            document.getElementById('userMenuBtn').addEventListener('click', function(e) {
                e.stopPropagation();
                const dropdown = document.getElementById('userDropdown');
                dropdown.classList.toggle('hidden');
            });
            
            document.addEventListener('click', function(e) {
                if (!document.getElementById('userMenuBtn').contains(e.target)) {
                    document.getElementById('userDropdown').classList.add('hidden');
                }
            });
            
            document.addEventListener('click', function(e) {
                const sidebar = document.querySelector('.sidebar');
                const mobileToggle = document.querySelector('.mobile-menu-toggle');
                
                if (sidebar && sidebar.classList.contains('active') && 
                    !sidebar.contains(e.target) && 
                    !mobileToggle.contains(e.target)) {
                    sidebar.classList.remove('active');
                }
            });
        }

        // ==================== AUTHENTICATION ====================
        function login() {
            const email = document.getElementById('loginEmail').value.trim().toLowerCase();
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                showToast('Please enter email and password', 'error');
                return;
            }
            
            const allUsers = JSON.parse(localStorage.getItem('ce_users')) || [];
            const user = allUsers.find(u => u.email.toLowerCase() === email);
            
            if (!user) {
                showToast('Account not found. Please contact administrator.', 'error');
                return;
            }
            
            if (user.password !== password) {
                showToast('Invalid password', 'error');
                return;
            }
            
            if (user.role !== 'employee') {
                showToast('Access denied. Employee access only.', 'error');
                return;
            }
            
            currentUser = user;
            sessionStorage.setItem('ce_current_employee', JSON.stringify(user.id));
            
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('dashboardPage').style.display = 'block';
            
            showToast('Login successful! Welcome back.', 'success');
            initializeDashboard();
        }

        function logout() {
            currentUser = null;
            sessionStorage.removeItem('ce_current_employee');
            
            if (currentTimer) {
                stopTimer();
            }
            
            document.getElementById('dashboardPage').style.display = 'none';
            document.getElementById('loginPage').style.display = 'flex';
            
            showToast('Signed out successfully', 'info');
        }

        function showSignup() {
            showToast('Please contact your administrator to create an account', 'info');
        }

        function showResetPassword() {
            showToast('Please contact your administrator to reset password', 'info');
        }

        // ==================== DASHBOARD INITIALIZATION ====================
        function initializeDashboard() {
            if (!currentUser) {
                logout();
                return;
            }
            
            updateUserInfo();
            updateDateTime();
            setInterval(updateDateTime, 60000);
            
            updateDashboardStats();
            loadDashboardActivity();
            loadProjectFilter();
            checkForActiveTimer();
            initializeCharts();
            
            setInterval(updateDashboardStats, 30000);
            setInterval(updateLastSync, 30000);
            
            switchTab('dashboard');
        }

        function updateUserInfo() {
            if (!currentUser) return;
            
            const avatarText = currentUser.firstName[0] + currentUser.lastName[0];
            
            document.getElementById('userAvatar').textContent = avatarText;
            document.getElementById('userName').textContent = `${currentUser.firstName} ${currentUser.lastName}`;
            document.getElementById('dropdownName').textContent = `${currentUser.firstName} ${currentUser.lastName}`;
            document.getElementById('dropdownEmail').textContent = currentUser.email;
            
            document.getElementById('profileAvatar').textContent = avatarText;
            document.getElementById('profileName').textContent = `${currentUser.firstName} ${currentUser.lastName}`;
            document.getElementById('profileEmailDisplay').textContent = currentUser.email;
            document.getElementById('profileFirstName').value = currentUser.firstName;
            document.getElementById('profileLastName').value = currentUser.lastName;
            document.getElementById('profileEmail').value = currentUser.email;
            document.getElementById('profileEmployeeId').value = currentUser.employeeId || currentUser.id.substring(0, 8).toUpperCase();
            document.getElementById('memberSince').textContent = new Date(currentUser.createdAt).getFullYear();
        }

        function updateDateTime() {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            };
            document.getElementById('currentDateTime').textContent = now.toLocaleDateString('en-US', options);
        }

        function updateLastSync() {
            const now = new Date();
            document.getElementById('lastSync').textContent = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        }

        // ==================== TIMER FUNCTIONS ====================
        function startTimer() {
            const task = document.getElementById('taskInput').value.trim();
            const project = document.getElementById('projectSelect').value;
            
            if (!task) {
                showToast('Please describe what you are working on', 'error');
                return;
            }
            
            if (currentTimer) {
                stopTimer();
            }
            
            currentTimer = {
                id: 'timer_' + Date.now(),
                userId: currentUser.id,
                userName: `${currentUser.firstName} ${currentUser.lastName}`,
                userEmail: currentUser.email,
                project: project,
                task: task,
                startTime: new Date().toISOString(),
                isRunning: true,
                isPaused: false
            };
            
            localStorage.setItem('current_employee_timer', JSON.stringify(currentTimer));
            
            totalSeconds = 0;
            timerInterval = setInterval(() => {
                totalSeconds++;
                updateTimerDisplay();
                updateTimerInfo();
            }, 1000);
            
            document.getElementById('startBtn').classList.add('hidden');
            document.getElementById('stopBtn').classList.remove('hidden');
            document.getElementById('pauseBtn').classList.remove('hidden');
            document.getElementById('taskInput').disabled = true;
            document.getElementById('projectSelect').disabled = true;
            document.getElementById('currentStatus').textContent = 'Working';
            document.getElementById('statusDetail').textContent = `On: ${task}`;
            
            updateTimerDisplay();
            updateTimerInfo();
            showToast('Timer started', 'success');
            updateDashboardStats();
            updateCurrentSessionInfo();
        }

        function stopTimer() {
            if (!currentTimer) return;
            
            clearInterval(timerInterval);
            
            const endTime = new Date().toISOString();
            const duration = formatDuration(totalSeconds);
            
            const timeRecord = {
                ...currentTimer,
                endTime: endTime,
                duration: duration,
                durationSeconds: totalSeconds,
                isRunning: false,
                date: new Date().toISOString().split('T')[0],
                recordedAt: new Date().toISOString()
            };
            
            timeRecords.push(timeRecord);
            localStorage.setItem('ce_time_records', JSON.stringify(timeRecords));
            
            currentTimer = null;
            localStorage.removeItem('current_employee_timer');
            
            document.getElementById('startBtn').classList.remove('hidden');
            document.getElementById('stopBtn').classList.add('hidden');
            document.getElementById('pauseBtn').classList.add('hidden');
            document.getElementById('timerDisplay').textContent = '00:00:00';
            document.getElementById('taskInput').disabled = false;
            document.getElementById('projectSelect').disabled = false;
            document.getElementById('taskInput').value = '';
            document.getElementById('currentStatus').textContent = 'Not Working';
            document.getElementById('statusDetail').textContent = 'Ready to start';
            
            showToast('Timer stopped and saved', 'success');
            
            updateDashboardStats();
            loadDashboardActivity();
            updateCurrentSessionInfo();
            if (document.getElementById('history').classList.contains('active')) {
                filterHistory();
            }
        }

        function pauseTimer() {
            if (!currentTimer) return;
            
            if (!currentTimer.isPaused) {
                clearInterval(timerInterval);
                currentTimer.isPaused = true;
                document.getElementById('pauseBtn').innerHTML = '<i class="fas fa-play"></i><span>Resume</span>';
                document.getElementById('currentTimerInfo').textContent = 'Paused';
                document.getElementById('currentStatus').textContent = 'Paused';
                showToast('Timer paused', 'info');
            } else {
                timerInterval = setInterval(() => {
                    totalSeconds++;
                    updateTimerDisplay();
                    updateTimerInfo();
                }, 1000);
                currentTimer.isPaused = false;
                document.getElementById('pauseBtn').innerHTML = '<i class="fas fa-pause"></i><span>Pause</span>';
                document.getElementById('currentTimerInfo').textContent = `Working on: ${currentTimer.task}`;
                document.getElementById('currentStatus').textContent = 'Working';
                showToast('Timer resumed', 'success');
            }
            
            localStorage.setItem('current_employee_timer', JSON.stringify(currentTimer));
        }

        function updateTimerDisplay() {
            const timerDisplay = document.getElementById('timerDisplay');
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;
            
            timerDisplay.textContent = 
                `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function updateTimerInfo() {
            if (currentTimer) {
                document.getElementById('currentTimerInfo').textContent = 
                    currentTimer.isPaused ? 'Paused' : `Working on: ${currentTimer.task}`;
            } else {
                document.getElementById('currentTimerInfo').textContent = 'Ready to start working';
            }
        }

        function checkForActiveTimer() {
            const savedTimer = localStorage.getItem('current_employee_timer');
            if (savedTimer) {
                const timer = JSON.parse(savedTimer);
                
                if (timer.userId === currentUser.id) {
                    currentTimer = timer;
                    
                    const startTime = new Date(timer.startTime);
                    const now = new Date();
                    totalSeconds = Math.floor((now - startTime) / 1000);
                    
                    timerInterval = setInterval(() => {
                        totalSeconds++;
                        updateTimerDisplay();
                        updateTimerInfo();
                    }, 1000);
                    
                    document.getElementById('startBtn').classList.add('hidden');
                    document.getElementById('stopBtn').classList.remove('hidden');
                    document.getElementById('pauseBtn').classList.remove('hidden');
                    document.getElementById('taskInput').value = timer.task;
                    document.getElementById('projectSelect').value = timer.project;
                    document.getElementById('taskInput').disabled = true;
                    document.getElementById('projectSelect').disabled = true;
                    document.getElementById('currentStatus').textContent = timer.isPaused ? 'Paused' : 'Working';
                    document.getElementById('statusDetail').textContent = timer.isPaused ? 'Timer paused' : `On: ${timer.task}`;
                    
                    if (timer.isPaused) {
                        document.getElementById('pauseBtn').innerHTML = '<i class="fas fa-play mr-2"></i><span>Resume</span>';
                        clearInterval(timerInterval);
                    }
                    
                    updateTimerDisplay();
                    updateTimerInfo();
                    showToast('Resumed previous timer', 'info');
                }
            }
            
            updateCurrentSessionInfo();
        }

        function updateCurrentSessionInfo() {
            const container = document.getElementById('currentSessionInfo');
            
            if (currentTimer) {
                container.innerHTML = `
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Project:</span>
                            <span class="font-medium">${currentTimer.project}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Task:</span>
                            <span class="font-medium">${currentTimer.task}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Started:</span>
                            <span class="font-medium">${new Date(currentTimer.startTime).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Duration:</span>
                            <span class="font-medium">${formatDuration(totalSeconds)}</span>
                        </div>
                        <div class="pt-3">
                            <span class="badge ${currentTimer.isPaused ? 'badge-warning' : 'badge-success'}">
                                ${currentTimer.isPaused ? '⏸️ Paused' : '▶️ Active'}
                            </span>
                        </div>
                    </div>
                `;
            } else {
                container.innerHTML = `
                    <div class="text-center py-6 text-gray-400">
                        <i class="fas fa-clock text-4xl mb-3"></i>
                        <p>No active session</p>
                        <p class="text-sm mt-1">Start a timer to begin tracking</p>
                    </div>
                `;
            }
        }

        // ==================== DASHBOARD STATS & CHARTS ====================
        function updateDashboardStats() {
            if (!currentUser) return;
            
            const today = new Date().toISOString().split('T')[0];
            
            const todayRecords = timeRecords.filter(r => 
                r.userId === currentUser.id && 
                r.date === today && 
                !r.isRunning
            );
            
            const todaySeconds = todayRecords.reduce((sum, r) => sum + (r.durationSeconds || 0), 0);
            const todayHours = (todaySeconds / 3600).toFixed(1);
            
            const startOfWeek = new Date();
            startOfWeek.setDate(startOfWeek.getDate() - startOfWeek.getDay() + 1);
            const weekRecords = timeRecords.filter(r => 
                r.userId === currentUser.id && 
                new Date(r.date) >= startOfWeek && 
                !r.isRunning
            );
            
            const weekSeconds = weekRecords.reduce((sum, r) => sum + (r.durationSeconds || 0), 0);
            const weekHours = (weekSeconds / 3600).toFixed(1);
            
            document.getElementById('todayHours').textContent = todayHours;
            document.getElementById('todaySessions').textContent = todayRecords.length;
            document.getElementById('weeklyTotal').textContent = weekHours;
            document.getElementById('daysThisWeek').textContent = new Set(weekRecords.map(r => r.date)).size;
            
            document.getElementById('todayHoursSummary').textContent = todayHours;
            document.getElementById('todaySessionsSummary').textContent = todayRecords.length;
            
            const avgSessionSeconds = todayRecords.length > 0 ? todaySeconds / todayRecords.length : 0;
            document.getElementById('avgSessionTime').textContent = formatDurationShort(avgSessionSeconds);
            
            const targetHours = 8 * 5;
            const productivityScore = Math.min((weekSeconds / 3600 / targetHours) * 100, 100);
            document.getElementById('productivityScore').textContent = `${Math.round(productivityScore)}%`;
            
            const allRecords = timeRecords.filter(r => r.userId === currentUser.id && !r.isRunning);
            const totalHours = allRecords.reduce((sum, r) => sum + (r.durationSeconds || 0), 0) / 3600;
            const avgDaily = allRecords.length > 0 ? totalHours / (new Set(allRecords.map(r => r.date)).size || 1) : 0;
            
            document.getElementById('profileTotalHours').textContent = Math.round(totalHours);
            document.getElementById('profileSessions').textContent = allRecords.length;
            document.getElementById('profileAvgDaily').textContent = avgDaily.toFixed(1);
            document.getElementById('profileProductivity').textContent = `${Math.round(productivityScore)}%`;
            
            if (weeklyChart) updateWeeklyChart();
            if (projectChart) updateProjectChart();
        }

        function loadDashboardActivity() {
            const container = document.getElementById('dashboardActivity');
            const today = new Date().toISOString().split('T')[0];
            
            const todaysRecords = timeRecords
                .filter(r => r.userId === currentUser.id && r.date === today && !r.isRunning)
                .sort((a, b) => new Date(b.startTime) - new Date(a.startTime))
                .slice(0, 5);
            
            container.innerHTML = '';
            
            if (todaysRecords.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-400">
                        <i class="fas fa-clock text-4xl mb-3"></i>
                        <p>No activity recorded today</p>
                    </div>
                `;
                return;
            }
            
            todaysRecords.forEach(record => {
                const activity = document.createElement('div');
                activity.className = 'flex items-center p-4 hover:bg-gray-50 rounded-xl transition-colors';
                
                activity.innerHTML = `
                    <div class="flex-shrink-0">
                        <div class="w-10 h-10 bg-blue-50 rounded-lg flex items-center justify-center">
                            <i class="fas fa-clock text-blue-500"></i>
                        </div>
                    </div>
                    <div class="ml-4 flex-1">
                        <div class="flex justify-between">
                            <p class="font-medium text-gray-900">${record.task}</p>
                            <span class="text-sm font-medium text-gray-900">${record.duration}</span>
                        </div>
                        <div class="flex items-center mt-1">
                            <span class="badge badge-primary mr-3">${record.project}</span>
                            <span class="text-xs text-gray-500">
                                ${new Date(record.startTime).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}
                                -
                                ${new Date(record.endTime).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}
                            </span>
                        </div>
                    </div>
                `;
                container.appendChild(activity);
            });
        }

        function initializeCharts() {
            const weeklyCtx = document.getElementById('weeklyChart').getContext('2d');
            weeklyChart = new Chart(weeklyCtx, {
                type: 'bar',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [{
                        label: 'Hours',
                        data: [0, 0, 0, 0, 0, 0, 0],
                        backgroundColor: 'rgba(37, 99, 235, 0.2)',
                        borderColor: 'rgba(37, 99, 235, 1)',
                        borderWidth: 2,
                        borderRadius: 8,
                        borderSkipped: false,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                drawBorder: false,
                            },
                            ticks: {
                                callback: function(value) {
                                    return value + 'h';
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.parsed.y + ' hours';
                                }
                            }
                        }
                    }
                }
            });
            
            const projectCtx = document.getElementById('projectChart').getContext('2d');
            projectChart = new Chart(projectCtx, {
                type: 'doughnut',
                data: {
                    labels: [],
                    datasets: [{
                        data: [],
                        backgroundColor: [
                            'rgba(37, 99, 235, 0.8)',
                            'rgba(16, 185, 129, 0.8)',
                            'rgba(139, 92, 246, 0.8)',
                            'rgba(245, 158, 11, 0.8)',
                            'rgba(239, 68, 68, 0.8)'
                        ],
                        borderWidth: 0,
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }
                        }
                    }
                }
            });
            
            updateWeeklyChart();
            updateProjectChart();
        }

        function updateWeeklyChart() {
            if (!weeklyChart) return;
            
            const today = new Date();
            const startOfWeek = new Date(today);
            startOfWeek.setDate(today.getDate() - today.getDay() + 1);
            
            const weekData = [0, 0, 0, 0, 0, 0, 0];
            
            timeRecords.filter(r => {
                const recordDate = new Date(r.date);
                return r.userId === currentUser.id && recordDate >= startOfWeek && !r.isRunning;
            }).forEach(r => {
                const recordDate = new Date(r.date);
                const dayOfWeek = recordDate.getDay();
                const index = dayOfWeek === 0 ? 6 : dayOfWeek - 1;
                weekData[index] += (r.durationSeconds || 0) / 3600;
            });
            
            weeklyChart.data.datasets[0].data = weekData;
            weeklyChart.update();
        }

        function updateProjectChart() {
            if (!projectChart) return;
            
            const startOfWeek = new Date();
            startOfWeek.setDate(startOfWeek.getDate() - startOfWeek.getDay() + 1);
            
            const projectHours = {};
            const weekRecords = timeRecords.filter(r => 
                r.userId === currentUser.id && 
                new Date(r.date) >= startOfWeek && 
                !r.isRunning
            );
            
            weekRecords.forEach(r => {
                if (!projectHours[r.project]) {
                    projectHours[r.project] = 0;
                }
                projectHours[r.project] += (r.durationSeconds || 0) / 3600;
            });
            
            projectChart.data.labels = Object.keys(projectHours);
            projectChart.data.datasets[0].data = Object.values(projectHours);
            projectChart.update();
        }

        // ==================== HISTORY FUNCTIONS ====================
        function loadProjectFilter() {
            const filter = document.getElementById('projectFilter');
            const userRecords = timeRecords.filter(r => r.userId === currentUser.id && !r.isRunning);
            const projects = [...new Set(userRecords.map(r => r.project))].sort();
            
            filter.innerHTML = '<option value="all">All Projects</option>';
            projects.forEach(project => {
                const option = document.createElement('option');
                option.value = project;
                option.textContent = project;
                filter.appendChild(option);
            });
        }

        function filterHistory() {
            const dateRange = document.getElementById('dateRangeFilter').value;
            const project = document.getElementById('projectFilter').value;
            const sortBy = document.getElementById('sortFilter').value;
            
            let userRecords = timeRecords.filter(r => r.userId === currentUser.id && !r.isRunning);
            
            const today = new Date().toISOString().split('T')[0];
            const startOfWeek = new Date();
            startOfWeek.setDate(startOfWeek.getDate() - startOfWeek.getDay() + 1);
            const startOfMonth = new Date();
            startOfMonth.setDate(1);
            
            if (dateRange === 'today') {
                userRecords = userRecords.filter(r => r.date === today);
            } else if (dateRange === 'week') {
                userRecords = userRecords.filter(r => new Date(r.date) >= startOfWeek);
            } else if (dateRange === 'month') {
                userRecords = userRecords.filter(r => new Date(r.date) >= startOfMonth);
            }
            
            if (project !== 'all') {
                userRecords = userRecords.filter(r => r.project === project);
            }
            
            if (sortBy === 'newest') {
                userRecords.sort((a, b) => new Date(b.startTime) - new Date(a.startTime));
            } else if (sortBy === 'oldest') {
                userRecords.sort((a, b) => new Date(a.startTime) - new Date(b.startTime));
            } else if (sortBy === 'duration') {
                userRecords.sort((a, b) => (b.durationSeconds || 0) - (a.durationSeconds || 0));
            }
            
            displayHistory(userRecords);
        }

        function displayHistory(records) {
            const table = document.getElementById('historyTable');
            const emptyState = document.getElementById('historyEmpty');
            
            table.innerHTML = '';
            
            if (records.length === 0) {
                emptyState.classList.remove('hidden');
                document.getElementById('recordsCount').textContent = '0 records';
                return;
            }
            
            emptyState.classList.add('hidden');
            document.getElementById('recordsCount').textContent = `${records.length} records`;
            
            records.forEach(record => {
                const row = document.createElement('tr');
                row.className = 'table-row';
                row.innerHTML = `
                    <td class="py-4 px-6">${record.date}</td>
                    <td class="py-4 px-6">
                        <span class="badge badge-primary">${record.project}</span>
                    </td>
                    <td class="py-4 px-6">${record.task}</td>
                    <td class="py-4 px-6">${new Date(record.startTime).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</td>
                    <td class="py-4 px-6">${new Date(record.endTime).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</td>
                    <td class="py-4 px-6 font-medium">${record.duration}</td>
                    <td class="py-4 px-6">
                        <button onclick="deleteRecord('${record.id}')" class="text-red-500 hover:text-red-700 p-2 rounded-lg hover:bg-red-50">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                table.appendChild(row);
            });
        }

        function resetHistoryFilters() {
            document.getElementById('dateRangeFilter').value = 'today';
            document.getElementById('projectFilter').value = 'all';
            document.getElementById('sortFilter').value = 'newest';
            filterHistory();
        }

        function deleteRecord(recordId) {
            if (!confirm('Are you sure you want to delete this record?')) {
                return;
            }
            
            timeRecords = timeRecords.filter(r => r.id !== recordId);
            localStorage.setItem('ce_time_records', JSON.stringify(timeRecords));
            
            showToast('Record deleted', 'info');
            
            updateDashboardStats();
            loadDashboardActivity();
            filterHistory();
            loadProjectFilter();
        }

        // ==================== MANUAL ENTRY ====================
        function showAddEntryModal() {
            const now = new Date();
            const oneHourAgo = new Date(now.getTime() - 3600000);
            
            document.getElementById('manualStartTime').value = formatDateTimeLocal(oneHourAgo);
            document.getElementById('manualEndTime').value = formatDateTimeLocal(now);
            
            showModal('addEntryModal');
        }

        function saveManualEntry() {
            const project = document.getElementById('manualProject').value;
            const task = document.getElementById('manualTask').value.trim();
            const startTime = document.getElementById('manualStartTime').value;
            const endTime = document.getElementById('manualEndTime').value;
            
            if (!task) {
                showToast('Please enter task description', 'error');
                return;
            }
            
            if (!startTime || !endTime) {
                showToast('Please select start and end times', 'error');
                return;
            }
            
            const startDate = new Date(startTime);
            const endDate = new Date(endTime);
            
            if (endDate <= startDate) {
                showToast('End time must be after start time', 'error');
                return;
            }
            
            const durationSeconds = Math.floor((endDate - startDate) / 1000);
            
            const timeRecord = {
                id: 'manual_' + Date.now(),
                userId: currentUser.id,
                userName: `${currentUser.firstName} ${currentUser.lastName}`,
                userEmail: currentUser.email,
                project: project,
                task: task,
                startTime: startDate.toISOString(),
                endTime: endDate.toISOString(),
                duration: formatDuration(durationSeconds),
                durationSeconds: durationSeconds,
                isRunning: false,
                date: startDate.toISOString().split('T')[0],
                recordedAt: new Date().toISOString(),
                isManual: true
            };
            
            timeRecords.push(timeRecord);
            localStorage.setItem('ce_time_records', JSON.stringify(timeRecords));
            
            closeModal('addEntryModal');
            showToast('Manual entry added successfully', 'success');
            
            updateDashboardStats();
            loadDashboardActivity();
            filterHistory();
            loadProjectFilter();
        }

        function addQuickEntry(type) {
            const now = new Date();
            let project, task, duration;
            
            switch(type) {
                case 'Meeting':
                    project = 'Meeting';
                    task = 'Team meeting';
                    duration = 3600;
                    break;
                default:
                    project = 'General';
                    task = 'Quick entry';
                    duration = 1800;
            }
            
            const startTime = new Date(now.getTime() - duration * 1000);
            
            const timeRecord = {
                id: 'quick_' + Date.now(),
                userId: currentUser.id,
                userName: `${currentUser.firstName} ${currentUser.lastName}`,
                userEmail: currentUser.email,
                project: project,
                task: task,
                startTime: startTime.toISOString(),
                endTime: now.toISOString(),
                duration: formatDuration(duration),
                durationSeconds: duration,
                isRunning: false,
                date: now.toISOString().split('T')[0],
                recordedAt: now.toISOString(),
                isQuick: true
            };
            
            timeRecords.push(timeRecord);
            localStorage.setItem('ce_time_records', JSON.stringify(timeRecords));
            
            showToast(`${type} entry added`, 'success');
            
            updateDashboardStats();
            loadDashboardActivity();
            filterHistory();
            loadProjectFilter();
        }

        // ==================== UTILITY FUNCTIONS ====================
        function formatDuration(totalSeconds) {
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;
            
            if (hours > 0) {
                return `${hours}h ${minutes}m`;
            } else if (minutes > 0) {
                return `${minutes}m ${seconds}s`;
            } else {
                return `${seconds}s`;
            }
        }

        function formatDurationShort(totalSeconds) {
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            
            if (hours > 0) {
                return `${hours}h ${minutes}m`;
            } else {
                return `${minutes}m`;
            }
        }

        function formatDateTimeLocal(date) {
            return date.toISOString().slice(0, 16);
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            document.querySelectorAll('.sidebar-item').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.remove('hidden');
            
            const tabBtn = document.querySelector(`[data-tab="${tabName}"]`);
            if (tabBtn) {
                tabBtn.classList.add('active');
            }
            
            if (tabName === 'dashboard') {
                updateDashboardStats();
                loadDashboardActivity();
            } else if (tabName === 'history') {
                filterHistory();
            }
            
            if (window.innerWidth < 1024) {
                const sidebar = document.querySelector('.sidebar');
                sidebar.classList.remove('active');
            }
        }

        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            
            let icon = 'fa-info-circle';
            let bgColor = 'bg-blue-600';
            
            if (type === 'success') {
                icon = 'fa-check-circle';
                bgColor = 'bg-green-600';
            } else if (type === 'error') {
                icon = 'fa-exclamation-circle';
                bgColor = 'bg-red-600';
            } else if (type === 'warning') {
                icon = 'fa-exclamation-triangle';
                bgColor = 'bg-yellow-600';
            }
            
            toast.className = `toast ${bgColor}`;
            toast.innerHTML = `
                <div class="flex items-center space-x-3">
                    <i class="fas ${icon}"></i>
                    <span>${message}</span>
                </div>
            `;
            
            toast.classList.remove('hidden');
            
            setTimeout(() => {
                toast.classList.add('hidden');
            }, 3000);
        }

        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function exportMyData() {
            if (!currentUser) return;
            
            const userRecords = timeRecords.filter(r => r.userId === currentUser.id && !r.isRunning);
            
            if (userRecords.length === 0) {
                showToast('No data to export', 'info');
                return;
            }
            
            let csv = 'Date,Project,Task,Start Time,End Time,Duration (hours),Duration\n';
            
            userRecords.forEach(record => {
                const hours = (record.durationSeconds || 0) / 3600;
                csv += `"${record.date}","${record.project}","${record.task}","${record.startTime}","${record.endTime}",${hours.toFixed(2)},"${record.duration}"\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `my-time-data-${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            showToast('Data exported to CSV', 'success');
        }

        function startQuickTimer() {
            document.getElementById('taskInput').value = 'Quick task - ' + new Date().toLocaleTimeString();
            switchTab('timer');
        }

        function toggleMobileMenu() {
            const sidebar = document.querySelector('.sidebar');
            sidebar.classList.toggle('active');
        }

        setInterval(() => {
            if (currentTimer) {
                localStorage.setItem('current_employee_timer', JSON.stringify(currentTimer));
            }
        }, 30000);

        window.addEventListener('click', function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        });
    </script>
</body>
</html>
